{"ast":null,"code":"import _toConsumableArray from\"C:/Users/ASUS/Desktop/harsh2/CSE/React Development/firebase_project/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"C:/Users/ASUS/Desktop/harsh2/CSE/React Development/firebase_project/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/ASUS/Desktop/harsh2/CSE/React Development/firebase_project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/ASUS/Desktop/harsh2/CSE/React Development/firebase_project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{addDoc,collection,getDocs,query,where,deleteDoc,doc}from\"firebase/firestore\";import{db,auth}from\"../../config/firebase\";import{useAuthState}from\"react-firebase-hooks/auth\";import{useEffect,useState}from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var Post=function Post(props){var post=props.post;var _useAuthState=useAuthState(auth),_useAuthState2=_slicedToArray(_useAuthState,1),user=_useAuthState2[0];var _useState=useState(null),_useState2=_slicedToArray(_useState,2),likes=_useState2[0],setLike=_useState2[1];var likesRef=collection(db,\"likes\");var likesDoc=query(likesRef,where(\"postId\",\"==\",post.id));var hasLiked=likes===null||likes===void 0?void 0:likes.find(function(like){return like.userId===(user===null||user===void 0?void 0:user.uid);});var getLikes=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return getDocs(likesDoc);case 2:data=_context.sent;setLike(data.docs.map(function(doc){return{userId:doc.data().userId,likeId:doc.id};}));case 4:case\"end\":return _context.stop();}},_callee);}));return function getLikes(){return _ref.apply(this,arguments);};}();var addLike=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var newDoc;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return addDoc(likesRef,{userId:user===null||user===void 0?void 0:user.uid,postId:post.id});case 3:newDoc=_context2.sent;if(user){setLike(function(prev){return prev?[].concat(_toConsumableArray(prev),[{userId:user===null||user===void 0?void 0:user.uid,likeId:newDoc.id}]):[{userId:user.uid,likeId:newDoc.id}];});}_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 10:case\"end\":return _context2.stop();}},_callee2,null,[[0,7]]);}));return function addLike(){return _ref2.apply(this,arguments);};}();var removeLike=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var likeToDeleteQuery,likeToDeleteData,likeId,likeToDelete;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;likeToDeleteQuery=query(likesRef,where(\"postId\",\"==\",post.id),where(\"userId\",\"==\",user===null||user===void 0?void 0:user.uid));_context3.next=4;return getDocs(likeToDeleteQuery);case 4:likeToDeleteData=_context3.sent;likeId=likeToDeleteData.docs[0].id;likeToDelete=doc(db,\"likes\",likeToDeleteData.docs[0].id);_context3.next=9;return deleteDoc(likeToDelete);case 9:if(user){setLike(function(prev){return prev&&(prev===null||prev===void 0?void 0:prev.filter(function(like){return like.likeId!==likeId;}));});}_context3.next=15;break;case 12:_context3.prev=12;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 15:case\"end\":return _context3.stop();}},_callee3,null,[[0,12]]);}));return function removeLike(){return _ref3.apply(this,arguments);};}();useEffect(function(){getLikes();},[]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:/*#__PURE__*/_jsx(\"h1\",{children:post.title})}),/*#__PURE__*/_jsx(\"div\",{className:\"body\",children:/*#__PURE__*/_jsx(\"p\",{children:post.description})}),/*#__PURE__*/_jsxs(\"div\",{className:\"footer\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"@\",post.username]}),/*#__PURE__*/_jsx(\"button\",{onClick:hasLiked?removeLike:addLike,children:hasLiked?/*#__PURE__*/_jsx(_Fragment,{children:\"\\uD83D\\uDC4E\"}):/*#__PURE__*/_jsx(_Fragment,{children:\"\\uD83D\\uDC4D\"})}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Likes: \",likes===null||likes===void 0?void 0:likes.length]})]}),/*#__PURE__*/_jsx(\"hr\",{})]});};","map":{"version":3,"names":["addDoc","collection","getDocs","query","where","deleteDoc","doc","db","auth","useAuthState","useEffect","useState","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Post","props","post","_useAuthState","_useAuthState2","_slicedToArray","user","_useState","_useState2","likes","setLike","likesRef","likesDoc","id","hasLiked","find","like","userId","uid","getLikes","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","data","wrap","_callee$","_context","prev","next","sent","docs","map","likeId","stop","apply","arguments","addLike","_ref2","_callee2","newDoc","_callee2$","_context2","postId","concat","_toConsumableArray","t0","console","log","removeLike","_ref3","_callee3","likeToDeleteQuery","likeToDeleteData","likeToDelete","_callee3$","_context3","filter","children","className","title","description","username","onClick","length"],"sources":["C:/Users/ASUS/Desktop/harsh2/CSE/React Development/firebase_project/src/pages/main/posts.tsx"],"sourcesContent":["import { Post as IPost} from \"./main\"\r\nimport { addDoc, collection, getDocs, query, where, deleteDoc, doc } from \"firebase/firestore\";\r\nimport { db, auth } from \"../../config/firebase\";\r\nimport { FirebaseError } from \"firebase/app\";\r\nimport { AuthStateHook, useAuthState } from \"react-firebase-hooks/auth\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\n\r\ninterface Props {\r\n    post: IPost;\r\n}\r\n\r\ninterface Like {\r\n    likeId: string;\r\n    userId: string;\r\n}\r\n\r\nexport const Post = (props: Props) => {\r\n\r\n    const {post} = props;\r\n    const [user] = useAuthState(auth);\r\n    \r\n    const [likes, setLike] = useState<Like[] | null>(null);\r\n    const likesRef = collection(db, \"likes\");\r\n\r\n    const likesDoc = query (likesRef, where(\"postId\", \"==\", post.id));\r\n\r\n    const hasLiked = likes?.find((like) => like.userId === user?.uid)\r\n    const getLikes = async () => {\r\n        const data = await getDocs(likesDoc);\r\n        setLike(data.docs.map((doc) => ({ userId: doc.data().userId, likeId: doc.id})));\r\n    }\r\n\r\n    const addLike = async () => {\r\n        try {\r\n            const newDoc = await addDoc(likesRef, {\r\n                userId: user?.uid,\r\n                postId: post.id,\r\n            });\r\n            if (user) {\r\n                setLike((prev) => prev ? [...prev, {userId: user?.uid, likeId: newDoc.id}] : [{ userId: user.uid, likeId: newDoc.id}]);\r\n            }\r\n        } catch (err) {\r\n            console.log(err);\r\n        }\r\n        \r\n    }\r\n\r\n    const removeLike = async () => {\r\n        try {\r\n            const likeToDeleteQuery = query(likesRef, where(\"postId\", \"==\", post.id), where(\"userId\", \"==\", user?.uid));\r\n            \r\n            \r\n            const likeToDeleteData = await getDocs(likeToDeleteQuery);\r\n            const likeId = likeToDeleteData.docs[0].id;\r\n            const likeToDelete = doc(db, \"likes\", likeToDeleteData.docs[0].id);\r\n            \r\n            await deleteDoc(likeToDelete);\r\n\r\n            if (user) {\r\n                setLike((prev) => prev && prev?.filter((like) => like.likeId !== likeId));\r\n            }\r\n        } catch (err) {\r\n            console.log(err);\r\n        }\r\n        \r\n    }\r\n\r\n\r\n    useEffect(() => {\r\n        getLikes();\r\n    }, []);\r\n\r\n    return (\r\n        <div>\r\n            <div className=\"title\">\r\n                <h1>{post.title}</h1>\r\n            </div>\r\n            <div className=\"body\">\r\n                <p>{post.description}</p>\r\n            </div>\r\n            <div className=\"footer\">\r\n                <p>@{post.username}</p>\r\n                <button onClick={hasLiked ? removeLike : addLike }>{hasLiked ? <>&#128078;</> : <>&#128077;</>}</button>\r\n                <p>Likes: {likes?.length}</p>\r\n            </div>\r\n            <hr />\r\n        </div>\r\n    )   \r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}